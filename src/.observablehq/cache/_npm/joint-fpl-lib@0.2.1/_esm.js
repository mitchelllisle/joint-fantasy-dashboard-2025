/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/joint-fpl-lib@0.2.1/dist/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
class t{draftBaseUrl="https://draft.premierleague.com/api";baseUrl="https://fantasy.premierleague.com/api";async getBootstrapStatic(){const t=await fetch(`${this.baseUrl}/bootstrap-static/`);if(!t.ok)throw new Error(`Failed to fetch bootstrap-static: ${t.statusText}`);return t.json()}async getDetails(t){const e=await fetch(`${this.draftBaseUrl}/league/${t}/details`);if(!e.ok)throw new Error(`Failed to fetch league details: ${e.statusText}`);return e.json()}async getUserHistory(t){const e=await fetch(`${this.draftBaseUrl}/entry/${t}/history`);if(!e.ok)throw new Error(`Failed to fetch user history: ${e.statusText}`);return e.json()}async getPicks(t,e){const n=await fetch(`${this.draftBaseUrl}/entry/${t}/event/${e}`);if(!n.ok)throw new Error(`Failed to fetch picks: ${n.statusText}`);return n.json()}}async function e(t,e){const n=await t.getDetails(e),o=n.standings,a=n.league_entries,r=(await Promise.all(o.map((async e=>{const n=a.find((t=>t.id===e.league_entry));if(!n)return[];return((await t.getUserHistory(n.entry_id)).history||[]).map((t=>({gameweek:t.event,player_first_name:n.player_first_name,team:n.entry_name,total:t.total_points,points:t.points,entry_id:n.entry_id,rank:0})))})))).flat();if(0===r.length)return{title:"No Data",sentence:"No gameweek data available yet.",data:[]};const i=[...new Set(r.map((t=>t.gameweek)))],s=[];for(const t of i){r.filter((e=>e.gameweek===t)).sort(((t,e)=>e.total-t.total)).forEach(((t,e)=>{s.push({...t,rank:e+1})}))}return{title:`Gameweek ${Math.max(...s.map((t=>t.gameweek)))} Standings`,sentence:"Latest standings from the draft league.",data:s}}async function n(t,e){const n=await t.getDetails(e),o=n.league_entries;return n.standings.map((t=>({id:t.league_entry,name:o.find((e=>e.id===t.league_entry))?.entry_name||"",user:o.find((e=>e.id===t.league_entry))?.player_first_name||"",rank:t.rank,total:t.total,event_total:t.event_total,last_rank:t.last_rank})))}async function o(t,e){const n=await t.getDetails(e),o=await t.getBootstrapStatic(),a=o.events.find((t=>t.is_current)),r=a?a.id:1,i={};o.elements.forEach((t=>{i[t.id]={...t,web_name:t.web_name||`${t.first_name} ${t.second_name}`}}));return(await Promise.all(n.league_entries.map((async e=>{try{return(await t.getPicks(e.entry_id,r)).picks.map((t=>{const n=i[t.element];return n?{...n,owner:e.entry_name,team_name:e.entry_name,position:t.position}:null})).filter((t=>null!==t))}catch(t){return console.error(`Error fetching picks for ${e.player_first_name}:`,t),[]}})))).flat()}const a={domain:["Thrillhouse","youngsandwich","Not the Wirtz Team","Endo Days"],range:["#00ff85","#e90052","#963cff","#04f5ff"]};function r(t,{Plot:e,d3:n,x:o="gameweek",y:r="rank",z:s="team",width:l}={}){const c=e.stackY2({x:o,z:s,order:r}),[d,m]=n.extent(e.valueof(t,o));return e.plot({title:"Rank Across Gameweeks",subtitle:"Shows the rankings as they change throughout the season",width:l,marginLeft:100,marginRight:100,x:{[l<480?"insetRight":"inset"]:30,label:null,grid:!0},y:{axis:null,inset:20,reverse:!0},color:a,marks:[e.lineY(t,{...c,stroke:s,strokeWidth:26,curve:"bump-x",sort:{color:"y",reduce:"first"},render:i({stroke:"var(--theme-background-alt)",strokeWidth:33})}),e.text(t,{...c,text:c.y,fill:"black",stroke:s,tip:!0}),l<480?null:e.text(t,{...c,filter:t=>t[o]<=d,text:s,dx:-20,textAnchor:"end"}),e.text(t,{...c,filter:t=>t[o]>=m,text:s,dx:20,textAnchor:"start"})]})}function i({stroke:t="currentColor",strokeWidth:e=3}={}){return(n,o,a,r,i,s)=>{const l=s(n,o,a,r,i);for(const n of[...l.childNodes]){const o=n.cloneNode(!0);o.setAttribute("stroke",t),o.setAttribute("stroke-width",e),n.parentNode.insertBefore(o,n)}return l}}function s(t){if(0===t.length)return 0;if(1===t.length)return 0;const e=[...t].sort(((t,e)=>t-e)),n=e.length,o=e.reduce(((t,e)=>t+e),0);if(0===o)return 0;let a=0;for(let t=0;t<n;t++)a+=(t+1)*e[t];return 2*a/(n*o)-(n+1)/n}function l(t,e,n="No data available"){return 0===t.length?[e.text([n],{frameAnchor:"middle",fontSize:16,fill:"#999"})]:[]}function c(t,{Plot:e,d3:n,width:o}={}){console.log("Gini chart - input data length:",t.length);const r=t.filter((t=>null!==t.owner));console.log("Gini chart - owned data length:",r.length);const i={};r.forEach((t=>{i[t.owner]||(i[t.owner]={owner:t.owner,points:[],maxPoints:0}),i[t.owner].points.push(t.total_points),i[t.owner].maxPoints=Math.max(i[t.owner].maxPoints,t.total_points)}));const c=Object.values(i).map((t=>({owner:t.owner,gini:100*s(t.points),maxPoints:t.maxPoints})));return console.log("Gini chart - giniData:",c),e.plot({title:"Gini Index by Owner",subtitle:"A measure of inequality in points scored. 0% = perfectly equal, 100 = one player has all the points. The lower the score, the more players are contributing the points. Size of hexagon represents max points scored by a single player.",width:o,height:500,color:{...a,legend:!1},y:{domain:[0,100],label:"Gini Index"},x:{label:null},r:{range:[5,20]},marginTop:40,marginLeft:80,marks:[e.hexagon(c,e.dodgeX({y:"gini",r:"maxPoints",fill:"owner",tip:!0,fillOpacity:.8,strokeWidth:10})),...l(c,e)]})}function d(t,{Plot:e,d3:n,width:o}={}){const r=t.filter((t=>t.minutes>0)),i=r.filter((t=>t.bonus>10)).sort(((t,e)=>e.bonus-t.bonus)).slice(0,10);return e.plot({title:"Bonus Points vs Total Points",subtitle:"Scatter plot showing all players. Owned players highlighted by team. Contours show player density.",width:o,height:500,x:{label:"Total Points"},y:{label:"Bonus Points"},color:{...a,legend:!0},marks:[e.density(r,{x:"total_points",y:"bonus",stroke:"#ccc",strokeOpacity:.5,strokeWidth:2,thresholds:5}),e.dot(r.filter((t=>!t.owner)),{x:"total_points",y:"bonus",fill:"#ddd",r:3,opacity:.3}),e.dot(r.filter((t=>t.owner)),{x:"total_points",y:"bonus",fill:"owner",stroke:"owner",strokeWidth:1.5,r:6,tip:!0,channels:{Player:"web_name",Team:"owner",Bonus:"bonus",Points:"total_points",Minutes:"minutes"}}),e.text(i,{x:"total_points",y:"bonus",text:"web_name",dy:-10,fontSize:9,fontWeight:"bold"})]})}function m(t,{Plot:e,d3:n,width:o}={}){const r=t.filter((t=>t.position>11)),i={};r.forEach((t=>{i[t.owner]||(i[t.owner]={owner:t.owner,points:0,count:0}),i[t.owner].points+=t.event_points||0,i[t.owner].count+=1}));const s=Object.values(i);return e.plot({title:"Points Left on Bench",subtitle:"Total points scored by benched players this gameweek",width:o,marginLeft:120,x:{label:"Points on Bench"},y:{label:null},color:{...a,legend:!1},marks:[e.barX(s,{x:"points",y:"owner",fill:"owner",tip:!0,sort:{y:"-x"}}),e.text(s,{x:"points",y:"owner",text:t=>t.points,dx:15,textAnchor:"start"})]})}function h(t,{Plot:e,d3:n,width:o}={}){const r={};t.forEach((t=>{r[t.team]||(r[t.team]={team:t.team,points:[],best:-1/0,worst:1/0}),r[t.team].points.push(t.points),r[t.team].best=Math.max(r[t.team].best,t.points),r[t.team].worst=Math.min(r[t.team].worst,t.points)}));const i=Object.values(r).map((t=>{const e=n.mean(t.points),o=n.deviation(t.points);return{team:t.team,mean:e,stdDev:o,best:t.best,worst:t.worst,consistencyScore:100-o/e*100}})),s=n.max(i,(t=>t.best)),l=n.min(i,(t=>t.worst))-5;return e.plot({title:"Consistency & Performance Range",subtitle:"Best/worst gameweek with average shown. Shorter bars = more consistent",width:o,marginLeft:120,x:{label:"Points",domain:[l,s]},y:{label:null},color:{...a,legend:!1},marks:[e.barX(i,{x1:"worst",x2:"best",y:"team",fill:"team",fillOpacity:.2}),e.tickX(i,{x:"mean",y:"team",stroke:"team",strokeWidth:4}),e.dot(i,{x:"best",y:"team",fill:"team",r:5}),e.dot(i,{x:"worst",y:"team",fill:"team",r:5}),e.tip(i,e.pointer({x:"mean",y:"team",title:t=>`${t.team}\nBest: ${t.best}\nAvg: ${t.mean.toFixed(1)}\nWorst: ${t.worst}\nStd Dev: ${t.stdDev.toFixed(1)}`}))]})}function u(t,{Plot:e,d3:n,width:o}={}){const a=n.max(t,(t=>t.gameweek)),r=t.filter((t=>t.gameweek>a-5));return e.plot({title:"Last 5 Gameweeks Form",subtitle:"Position finished each gameweek. 1 = First place, 4 = Last place.",width:o,height:180,marginLeft:120,marginRight:60,x:{label:"Gameweek",tickFormat:t=>`GW${t}`,domain:n.range(a-4,a+1),padding:0},y:{label:null,padding:0},color:{type:"ordinal",domain:[1,2,3,4],range:["#10b981","#fbbf24","#f97316","#ef4444"],legend:!0,label:"Position"},marks:[e.cell(r,{x:"gameweek",y:"team",fill:"rank",tip:!0,inset:0}),e.text(r,{x:"gameweek",y:"team",text:t=>1===t.rank?"1st":2===t.rank?"2nd":3===t.rank?"3rd":"4th",fill:"white",fontWeight:"bold",fontSize:11})]})}function f(t,{Plot:e,d3:n,width:o}={}){const r="gameweek",i="points",s="team";let c;return 1===new Set(t.map((t=>t.team))).size&&(c=e.lineY(t,e.windowY(5,{x:r,y:i,curve:"cardinal",stroke:"white"}))),e.plot({title:"Score per Gameweek",subtitle:"Shows the total score for each player over the course of the season",style:"overflow: visible;",width:o,y:{grid:!0},color:{...a,legend:!0},marks:[e.ruleY([0]),e.barY(t,{x:r,y:i,fill:s,order:s,tip:!0}),c,...l(t,e)]})}function w(t,{Plot:e,d3:n,width:o}={}){const r="gameweek",i="total",s="team";return e.plot({title:"Points per Gameweek",subtitle:"Shows a cumulative points total for each player over the course of the season",style:"overflow: visible;",width:o,y:{grid:!0},color:{...a,legend:!0},marks:[e.ruleY([0]),e.axisY({label:"Points"}),e.axisX({label:"Gameweek"}),e.lineY(t,{x:r,y:i,stroke:s,curve:"natural",marker:"circle-stroke",tip:!0}),e.text(t,e.selectLast({x:r,y:i,z:s,text:s,textAnchor:"start",dx:3})),...l(t,e)]})}function p(t,{Plot:e,d3:n,width:o}={}){const a=t.filter((t=>t.position<=11)),r={1:"GK",2:"DEF",3:"MID",4:"FWD"},i={};a.forEach((t=>{const e=`${t.owner}_${t.element_type}`;i[e]||(i[e]={owner:t.owner,position:r[t.element_type]||"Unknown",points:0}),i[e].points+=t.total_points||0}));const s=Object.values(i);return e.plot({title:"Points by Position",subtitle:"Total season points contribution by position (starting XI only)",width:o,marginLeft:120,x:{label:"Total Points"},y:{label:null},color:{domain:["GK","DEF","MID","FWD"],range:["#e90052","#963cff","#04f5ff","#00ff85"],legend:!0},marks:[e.barX(s,e.stackX({x:"points",y:"owner",fill:"position",tip:!0,sort:{y:"-x",reduce:"sum"}})),e.ruleX([0])]})}export{t as PremierLeagueAPI,m as benchPoints,d as bonusPoints,r as bumpChart,s as calculateGini,a as colours,h as consistencyBullet,u as formChart,e as getMatchResults,o as getSquads,n as getStandings,c as giniIndexChart,l as noDataTextMark,f as pointsBarChart,w as pointsPerWeek,p as positionBreakdown};export default null;
